import sys
from pathlib import Path

import pytest

PROJECT_ROOT = Path(__file__).resolve().parents[1]
sys.path.insert(0, str(PROJECT_ROOT))

from job_fit_analysis.applied_tracker import AppliedTracker, DEFAULT_TRACKER_PATH, DEFAULT_SHEET_NAME

TRACKER_PATH = Path("/Users/Roger/Documents/FullTime-Resume/Job Tracker.xlsx")
SHEET_NAME = "Job Tracker"

tracker = AppliedTracker(TRACKER_PATH, SHEET_NAME)

# Update the tuples below so they reflect real rows in the tracker.
# expected=True  => application exists within ~2 months
# expected=False => application either absent or older than ~2 months
TEST_CASES = [
    ("Scotiabank", "Test Automation Engineer", "wrong job description", False),
    ("Broadridge", "Associate Software Engineer (Hybrid)", "wrong job description", False),
    ("TD Bank", "QA Automation Developer", "wrong job description", False),
    ("RBC", "Software Developer", "Wrong job description", False),
    ("Manulife", "Associate AI Engineer", "ntent extraction and chunk/loading to vector stores\nData Pipeline Management: Work with data engineers to establish high-quality data pipelines that ensure efficient data processing for AI applications.\nModel Optimization: Regularly assess and enhance AI models and systems for optimal performance, accuracy, and reliability.\nResponsible AI Practices: Advocate for and apply responsible AI practices and rigorous testing methodologies.\nContinuous Innovation: Keep up with the latest AI technologies and research, incorporating new methodologies to enhance our solutions.\nCollaboration: Actively learn from senior engineers and contribute to a collaborative, innovative team environment.\nEfficient Human Feedback Loops: Implement efficient human feedback loops to refine and improve AI actioning solutions\n\n\nRequired Qualifications\n\n\nProfessional Experience: At least 2 years of experience in AI engineering with a proven track record of successfully building and deploying AI solutions.\nTechnical Proficiency: Familiarity with AI frameworks and libraries such as LangChain, LangGraph, or OpenAI SDK, and Strong Python programming language skills.\nEducational Background: Bachelor’s degree in computer science, Engineering, or a related field; equivalent technical experience is also considered.\n\n\nPreferred Qualifications\n\n\nPrompt Engineering: Strong skills in prompt engineering and indexing/retrieval techniques.\nAI Engineering: Strong skills in developing production grade AI code, building APIs with best practices and integrate with UI. \nDistributed Systems: Experience with distributed computing frameworks and cloud platforms like AWS, Azure, or Google Cloud.\nMachine Learning Expertise: Foundational knowledge of machine learning algorithms and experience in applying pre-built models.\nData Engineering Skills: Understanding of data engineering principles, including data pipelines and ETL processes.\nProblem-Solving Ability: Exceptional problem-solving skills with the capacity to tackle complex technical challenges.\nEffective Communication: Excellent communication skills to effectively collaborate with cross-functional teams and convey technical concepts to non-technical stakeholders.\n\n\nWhen You Join Our Team\n\n\nWe’ll empower you to learn and grow the career you want. \nWe’ll recognize and support you in a flexible environment where well-being and inclusion are more than just words. \nAs part of our global team, we’ll support you in shaping the future you want to see. \n\n\nAbout Manulife And John Hancock\n\nManulife Financial Corporation is a leading international financial services provider, helping people make their decisions easier and lives better. To learn more about us, visit https://www.manulife.com/en/about/our-story.html.\n\nManulife is an Equal Opportunity Employer\n\nAt Manulife/John Hancock, we embrace our diversity. We strive to attract, develop and retain a workforce that is as diverse as the customers we serve and to foster an inclusive work environment that embraces the strength of cultures and individuals. We are committed to fair recruitment, retention, advancement and compensation, and we administer all of our practices and programs without discrimination on the basis of race, ancestry, place of origin, colour, ethnic origin, citizenship, religion or religious beliefs, creed, sex (including pregnancy and pregnancy-related conditions), sexual orientation, genetic characteristics, veteran status, gender identity, gender expression, age, marital status, family status, disability, or any other ground protected by applicable law.\n\nIt is our priority to remove barriers to provide equal access to employment. A Human Resources representative will work with applicants who request a reasonable accommodation during the application process. All information shared during the accommodation request process will be stored and used in a manner that is consistent with applicable laws and Manulife/John Hancock policies. To request a reasonable accommodation in the application process, contact recruitment@manulife.com.\n\nReferenced Salary Location\n\nToronto, Ontario\n\nWorking Arrangement\n\nHybrid\n\nSalary range is expected to be between\n\n$60,900.00 CAD - $113,100.00 CAD\n\nIf you are applying for this role outside of the primary location, please contact recruitment@manulife.com for the salary range for your location. The actual salary will vary depending on local market conditions, geography and relevant job-related factors such as knowledge, skills, qualifications, experience, and education/training. Employees also have the opportunity to participate in incentive programs and earn incentive compensation tied to business and individual performance.\n\nManulife offers eligible employees a wide array of customizable benefits, including health, dental, mental health, vision, short- and long-term disability, life and AD&D insurance coverage, adoption/surrogacy and wellness benefits, and employee/family assistance plans. We also offer eligible employees various retirement savings plans (including pension and a global share ownership plan with employer matching contributions) and financial education and counseling resources. Our generous paid time off program in Canada includes holidays, vacation, personal, and sick days, and we offer the full range of statutory leaves of absence. If you are applying for this role in the U.S., please contact recruitment@manulife.com for more information about U.S.-specific paid time off provisions.", True),
    ("Modall", "Frontend Developer (React/Next.js)", "Wrong job description", False),
    ("Rangam", "RCI-GT-38127 Backend Software Engineer (Healthcare _ Genomics)", "About the job\n\nJob Summary:\n\nLocation: Mississauga (Onsite 3 days/week)\n\n\n\n\nOverview:\n\nJoin our Impact Healthcare engineering team to build secure, scalable backend systems supporting next-generation genomic sequencing and diagnostic platforms. This role focuses on backend development using Java, Spring Boot, distributed systems, and cloud (AWS / Serverless).\n\nResponsibilities:\n\nParticipate in requirement discussions, architecture, and design reviews.\nDevelop clean, well-documented backend code following best practices.\nBuild and test REST APIs, microservices, and supporting infrastructure.\nWrite unit, integration, and component tests.\nCollaborate closely with QA to ensure strong test coverage.\nMentor junior developers when needed.\nContribute throughout the full software development lifecycle.\n\nRequired Experience:\n\n5–10 years of backend software development.\nStrong hands-on experience with Java, Spring Boot, REST APIs, and microservices.\nSolid understanding of object-oriented design and distributed systems.\nExperience with relational databases (Postgres / MySQL).\nStrong communication and teamwork skills; comfortable with Agile environments.\n\nNice to Have:\n\nExperience with AWS (especially serverless services).\nExposure to ETL or Scala.\nBackground in life sciences or genomic sequencing projects.\n\nFirst 60-Day Expectations:\n\nComplete onboarding and adopt team workflows.\nDeliver an initial backend feature independently.\nWrite clear tests and documentation for assigned work.", True),
]


@pytest.mark.parametrize("company, position, job_description, expected", TEST_CASES)
def test_already_applied_cases(company: str, position: str, job_description: str, expected: bool):
    assert tracker.is_applied(company, position, job_description=job_description) is expected
